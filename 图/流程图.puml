@startuml 图书借阅系统流程图

title 图书借阅系统流程图（文件存储版）

actor 读者 as Reader
actor 管理员 as Admin
participant "登录系统" as Login
participant "图书管理" as BookMgmt
participant "借阅管理" as BorrowMgmt
participant "还书管理" as ReturnMgmt
participant "用户管理" as UserMgmt
participant "文件系统" as FileSystem

== 用户登录 ==
Reader -> Login: 输入用户名密码
Login -> FileSystem: 读取用户信息文件
FileSystem -> Login: 返回用户数据
alt 登录成功
    Login -> Reader: 登录成功，进入主界面
else 登录失败
    Login -> Reader: 显示错误信息
    Reader -> Login: 重新输入
end

== 图书查询与借阅 ==
Reader -> BookMgmt: 查询图书
BookMgmt -> FileSystem: 读取图书信息文件
FileSystem -> BookMgmt: 返回图书列表
BookMgmt -> Reader: 显示图书信息

Reader -> BorrowMgmt: 申请借阅图书
BorrowMgmt -> FileSystem: 读取图书库存文件
FileSystem -> BorrowMgmt: 返回库存信息

alt 图书可借
    BorrowMgmt -> FileSystem: 更新借阅记录文件
    BorrowMgmt -> FileSystem: 更新图书状态文件
    FileSystem -> BorrowMgmt: 文件更新成功
    BorrowMgmt -> Reader: 借阅成功通知
else 图书不可借
    BorrowMgmt -> Reader: 图书已借完或不存在
end

== 图书归还 ==
Reader -> ReturnMgmt: 归还图书
ReturnMgmt -> FileSystem: 读取借阅记录文件
FileSystem -> ReturnMgmt: 返回借阅信息

alt 借阅记录存在
    ReturnMgmt -> FileSystem: 更新借阅记录文件
    ReturnMgmt -> FileSystem: 更新图书可借状态文件
    FileSystem -> ReturnMgmt: 文件更新成功
    ReturnMgmt -> Reader: 归还成功通知
else 借阅记录不存在
    ReturnMgmt -> Reader: 无借阅记录或已归还
end

== 管理员功能 ==
Admin -> Login: 管理员登录
Login -> FileSystem: 读取管理员权限文件
FileSystem -> Login: 返回权限信息
Login -> Admin: 进入管理界面

Admin -> BookMgmt: 图书管理操作
BookMgmt -> FileSystem: 读写图书信息文件
FileSystem -> BookMgmt: 返回操作结果
BookMgmt -> Admin: 显示操作结果

Admin -> UserMgmt: 用户管理操作
UserMgmt -> FileSystem: 读写用户信息文件
FileSystem -> UserMgmt: 返回操作结果
UserMgmt -> Admin: 显示操作结果

Admin -> BorrowMgmt: 查看借阅统计
BorrowMgmt -> FileSystem: 读取借阅记录文件
FileSystem -> BorrowMgmt: 返回统计数据
BorrowMgmt -> Admin: 显示借阅报表

note right of FileSystem
  数据存储文件:
  - users.txt (用户信息)
  - books.txt (图书信息)
  - borrows.txt (借阅记录)
  - admins.txt (管理员信息)
end note

@enduml